{% extends "base.html" %}

{% block title %}Driver Profiles - GES Solar EMS{% endblock %}

{% block page_subtitle %}Driver Profiles{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6 space-y-6">
  <h1 class="text-xl font-semibold">Settings ‚Äì Driver Profiles</h1>
  
  <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
    <div class="flex items-center justify-between mb-3">
      <h2 class="font-semibold">Device Driver Profiles</h2>
      <div class="space-x-2">
        <button id="btnNewProfile" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700">New Profile</button>
        <button id="btnImportProfile" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700">Import</button>
      </div>
    </div>
    
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <div class="lg:col-span-1">
        <h3 class="font-semibold mb-2">Available Profiles</h3>
        <div class="space-y-2" id="profilesList">
          <!-- Profiles will be populated by JavaScript -->
        </div>
      </div>
      
      <div class="lg:col-span-2" id="profileDetailsSection">
        <div id="noProfileSelected" class="text-center py-8">
          <div class="text-4xl mb-2">üìù</div>
          <div class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-1">No Profile Selected</div>
          <div class="text-sm text-gray-500">Select a profile from the list to view and edit its details</div>
        </div>
        
        <div id="profileDetailsForm" class="hidden space-y-4">
          <h3 class="font-semibold mb-2">Profile Details: "<span id="selectedProfileTitle">-</span>"</h3>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <label class="text-sm text-gray-700 dark:text-gray-300">
              Profile Name
              <input id="profileName" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-gray-900 dark:text-gray-100" />
            </label>
            <label class="text-sm text-gray-700 dark:text-gray-300">
              Point Map File
              <input id="pointMapFile" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-gray-900 dark:text-gray-100" />
            </label>
            <label class="text-sm text-gray-700 dark:text-gray-300">
              Poll Interval (s)
              <input id="pollInterval" type="number" min="1" max="300" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-gray-900 dark:text-gray-100" />
            </label>
            <label class="text-sm text-gray-700 dark:text-gray-300">
              Timeout (ms)
              <input id="timeout" type="number" min="1000" max="30000" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-gray-900 dark:text-gray-100" />
            </label>
            <label class="text-sm text-gray-700 dark:text-gray-300">
              Retries
              <input id="retries" type="number" min="0" max="10" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-gray-900 dark:text-gray-100" />
            </label>
            <label class="text-sm text-gray-700 dark:text-gray-300">
              Protocol
              <select id="protocol" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2 text-gray-900 dark:text-gray-100">
                <option value="modbus_tcp">Modbus TCP</option>
                <option value="modbus_rtu">Modbus RTU</option>
                <option value="mqtt">MQTT</option>
                <option value="can">CAN Bus</option>
                <option value="serial">Serial</option>
              </select>
            </label>
          </div>
          
          <div>
            <h4 class="font-medium mb-2 text-gray-900 dark:text-gray-100">Control Capabilities</h4>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2 text-sm" id="controlCapabilities">
              <label class="flex items-center gap-2 text-gray-700 dark:text-gray-300">
                <input type="checkbox" id="cap_power_limit" />Set Active Power Limit
              </label>
              <label class="flex items-center gap-2 text-gray-700 dark:text-gray-300">
                <input type="checkbox" id="cap_open_breaker" />Open Breaker
              </label>
              <label class="flex items-center gap-2 text-gray-700 dark:text-gray-300">
                <input type="checkbox" id="cap_close_breaker" />Close Breaker
              </label>
              <label class="flex items-center gap-2 text-gray-700 dark:text-gray-300">
                <input type="checkbox" id="cap_emergency_stop" />Emergency Stop
              </label>
              <label class="flex items-center gap-2 text-gray-700 dark:text-gray-300">
                <input type="checkbox" id="cap_reactive_power" />Reactive Power Control
              </label>
              <label class="flex items-center gap-2 text-gray-700 dark:text-gray-300">
                <input type="checkbox" id="cap_frequency" />Frequency Control
              </label>
            </div>
          </div>
          
          <div>
            <h4 class="font-medium mb-2 text-gray-900 dark:text-gray-100">Point Map Preview</h4>
            <div id="pointMapPreview" class="bg-gray-50 dark:bg-gray-900 rounded-md p-3 text-xs font-mono max-h-40 overflow-y-auto text-gray-800 dark:text-gray-200">
              <!-- Point map preview will be populated here -->
            </div>
          </div>
          
          <div class="pt-4 border-t border-gray-200 dark:border-gray-800">
            <button id="btnSaveProfile" class="px-3 py-2 rounded-md bg-brand-600 text-white hover:bg-brand-700">Save Changes</button>
            <button id="btnTestProfile" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 ml-2">Test Connection</button>
            <button id="btnResetProfile" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 ml-2">Reset</button>
            <button id="btnDeleteProfile" class="px-3 py-2 rounded-md bg-red-600 text-white hover:bg-red-700 ml-2">Delete</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/assets/js/profiles.js"></script>
{% endblock %}