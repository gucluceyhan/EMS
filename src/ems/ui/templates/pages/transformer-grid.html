{% extends "base.html" %}

{% block title %}Transformer & Grid - GES Solar EMS{% endblock %}

{% block page_subtitle %}Transformer & Grid Monitoring{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6 space-y-6">
  <h1 class="text-xl font-semibold">Transformer & Grid Monitoring</h1>
  
  <!-- Grid Status Overview -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2">âš¡</div>
      <div class="text-sm text-gray-500">Grid Voltage</div>
      <div class="text-2xl font-semibold">402.5 V</div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2">ðŸ”„</div>
      <div class="text-sm text-gray-500">Grid Frequency</div>
      <div class="text-2xl font-semibold">50.02 Hz</div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2">ðŸ“Š</div>
      <div class="text-sm text-gray-500">Power Factor</div>
      <div class="text-2xl font-semibold">0.97</div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2">ðŸ”¥</div>
      <div class="text-sm text-gray-500">Transformer Load</div>
      <div class="text-2xl font-semibold">68%</div>
    </div>
  </div>

  <!-- Transformer Details -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <h3 class="font-semibold mb-2">Transformer Status</h3>
      <div class="space-y-3">
        <div class="grid grid-cols-2 gap-4 text-sm">
          <div>Primary Voltage: <span class="font-medium">34.5 kV</span></div>
          <div>Secondary Voltage: <span class="font-medium">0.4 kV</span></div>
          <div>Load Current: <span class="font-medium">845 A</span></div>
          <div>Oil Temperature: <span class="font-medium">65Â°C</span></div>
          <div>Tap Position: <span class="font-medium">+3</span></div>
          <div>Status: <span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">Normal</span></div>
        </div>
        
        <div class="pt-3 border-t border-gray-200 dark:border-gray-800">
          <h4 class="font-medium mb-2">OLTC Control</h4>
          <div class="flex items-center gap-2">
            <button id="oltcRaise" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700">Raise (+)</button>
            <button id="oltcLower" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700">Lower (-)</button>
            <span class="text-sm text-gray-500 ml-2">Current: +3</span>
          </div>
        </div>
      </div>
    </div>
    
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <h3 class="font-semibold mb-2">Power Flow</h3>
      <div class="space-y-4">
        <!-- Power Flow Diagram -->
        <svg viewBox="0 0 400 200" class="w-full h-48 border border-gray-200 dark:border-gray-800 rounded-md">
          <!-- Grid -->
          <rect x="20" y="80" width="60" height="40" fill="#ef4444" stroke="#dc2626" stroke-width="2" rx="4"/>
          <text x="50" y="105" text-anchor="middle" class="text-xs fill-white">Grid</text>
          
          <!-- Transformer -->
          <rect x="150" y="70" width="80" height="60" fill="#3b82f6" stroke="#2563eb" stroke-width="2" rx="4"/>
          <text x="190" y="105" text-anchor="middle" class="text-xs fill-white">TX</text>
          
          <!-- Load -->
          <rect x="320" y="80" width="60" height="40" fill="#10b981" stroke="#059669" stroke-width="2" rx="4"/>
          <text x="350" y="105" text-anchor="middle" class="text-xs fill-white">Load</text>
          
          <!-- Power Flow Lines -->
          <line x1="80" y1="100" x2="150" y2="100" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
          <line x1="230" y1="100" x2="320" y2="100" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
          
          <!-- Values -->
          <text x="115" y="95" text-anchor="middle" class="text-xs">25.5 MW</text>
          <text x="275" y="95" text-anchor="middle" class="text-xs">24.8 MW</text>
          
          <defs>
            <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
              <polygon points="0 0, 10 3.5, 0 7" fill="#374151"/>
            </marker>
          </defs>
        </svg>
      </div>
    </div>
  </div>

  <!-- Grid Measurements -->
  <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl">
    <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-800">
      <h3 class="font-semibold">Real-time Grid Measurements</h3>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-800 text-white uppercase tracking-wide text-xs">
          <tr>
            <th class="px-3 py-2 text-left">Parameter</th>
            <th class="px-3 py-2 text-left">Phase A</th>
            <th class="px-3 py-2 text-left">Phase B</th>
            <th class="px-3 py-2 text-left">Phase C</th>
            <th class="px-3 py-2 text-left">Total/Avg</th>
            <th class="px-3 py-2 text-left">Status</th>
          </tr>
        </thead>
        <tbody>
          <tr class="border-b border-gray-200 dark:border-gray-800 text-gray-900 dark:text-gray-100">
            <td class="px-3 py-2 font-medium text-gray-900 dark:text-gray-100">Voltage (V)</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">401.2</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">402.8</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">401.9</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">402.0</td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800 dark:bg-green-500/20 dark:text-green-300">Normal</span></td>
          </tr>
          <tr class="border-b border-gray-200 dark:border-gray-800 text-gray-900 dark:text-gray-100">
            <td class="px-3 py-2 font-medium text-gray-900 dark:text-gray-100">Current (A)</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">847.5</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">851.2</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">849.1</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">849.3</td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800 dark:bg-green-500/20 dark:text-green-300">Normal</span></td>
          </tr>
          <tr class="border-b border-gray-200 dark:border-gray-800 text-gray-900 dark:text-gray-100">
            <td class="px-3 py-2 font-medium text-gray-900 dark:text-gray-100">Power (MW)</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">8.52</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">8.47</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">8.51</td>
            <td class="px-3 py-2 text-gray-900 dark:text-gray-100">25.5</td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800 dark:bg-green-500/20 dark:text-green-300">Normal</span></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Transformer & Grid specific JavaScript
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize transformer monitoring UI
  });
</script>
{% endblock %}