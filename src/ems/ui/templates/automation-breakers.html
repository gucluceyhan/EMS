{% extends "base.html" %}

{% block title %}Breakers (TMŞ) - GES Solar EMS{% endblock %}

{% block page_subtitle %}Energy Automation — Breakers (TMŞ){% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6 space-y-6">
  <!-- Filters -->
  <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 flex flex-wrap gap-3 items-end">
    <div>
      <label class="text-sm">Site</label>
      <select id="siteFilter" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1">
        <option>All Sites</option>
        <option>Ankara Sincan GES</option>
        <option>ODTÜ Teknokent GES</option>
        <option>Antalya Manavgat GES</option>
      </select>
    </div>
    <div>
      <label class="text-sm">Breaker Type</label>
      <select id="typeFilter" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1">
        <option>All Types</option>
        <option>Main Breaker</option>
        <option>Feeder</option>
        <option>String</option>
        <option>Transformer</option>
      </select>
    </div>
    <div>
      <label class="text-sm">Status</label>
      <select id="statusFilter" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1">
        <option>All</option>
        <option>Closed</option>
        <option>Open</option>
        <option>Fault</option>
      </select>
    </div>
    <div>
      <label class="text-sm flex items-center gap-1">
        <input id="dryRunToggle" type="checkbox" class="h-4 w-4" checked />
        Dry Run
      </label>
    </div>
  </div>

  <!-- Row 1 -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <h3 class="font-semibold mb-2">Breakers Overview</h3>
      <div id="breakerGrid" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4"></div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <h3 class="font-semibold mb-2">Busbar Load Distribution</h3>
      <div id="busbarBars" class="flex items-end gap-2 h-40"></div>
    </div>
  </div>

  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2 bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 sticky lg:top-[84px]">
      <h3 class="font-semibold mb-2">Selected Breaker — Live Measurements</h3>
      <div id="measureGrid" class="grid grid-cols-2 md:grid-cols-3 gap-3"></div>
      <div class="mt-4">
        <svg id="trendSvg" viewBox="0 0 400 100" class="w-full h-24"></svg>
      </div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <details>
        <summary class="font-semibold cursor-pointer">Settings (Mapping)</summary>
        <div class="mt-3 grid grid-cols-2 gap-3 text-sm">
          <label>Open Coil<input id="mapOpen" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1" /></label>
          <label>Close Coil<input id="mapClose" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1" /></label>
          <label>Pulse ms<input id="mapPulse" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1" /></label>
          <label>Open FB<input id="mapOpenFb" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1" /></label>
          <label>Close FB<input id="mapCloseFb" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1" /></label>
          <label>Trip FB<input id="mapTripFb" class="w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-2 py-1" /></label>
          <button id="btnSaveMap" class="col-span-2 mt-2 px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700">Save</button>
        </div>
      </details>
    </div>
  </div>
</div>

<!-- Confirmation Modal -->
<div id="confirmModal" class="fixed inset-0 hidden items-center justify-center bg-black/50">
  <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-6 w-full max-w-md">
    <h4 class="font-semibold mb-2">Confirm Action</h4>
    <p class="text-sm text-gray-500">Enter PIN or have Admin confirm to proceed.</p>
    <input id="confirmPin" placeholder="PIN" class="mt-3 w-full bg-transparent border border-gray-200 dark:border-gray-700 rounded-md px-3 py-2" />
    <div class="mt-4 flex items-center justify-end gap-2">
      <button id="btnCancelConfirm" class="px-3 py-2 rounded-md border border-gray-200 dark:border-gray-700">Cancel</button>
      <button id="btnOkConfirm" class="px-3 py-2 rounded-md bg-red-600 text-white">Confirm</button>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="/static/assets/js/automation.js"></script>
{% endblock %}