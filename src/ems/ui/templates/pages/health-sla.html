{% extends "base.html" %}

{% block title %}Health & SLA - GES Solar EMS{% endblock %}

{% block page_subtitle %}Health Monitoring & SLA Tracking{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-6 space-y-6">
  <h1 class="text-xl font-semibold">Health & SLA Monitoring</h1>
  
  <!-- SLA Overview -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2 text-green-500">üíö</div>
      <div class="text-sm text-gray-500">System Uptime</div>
      <div class="text-2xl font-semibold text-green-600">99.87%</div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2 text-blue-500">üïê</div>
      <div class="text-sm text-gray-500">Avg Response Time</div>
      <div class="text-2xl font-semibold text-blue-600">1.2s</div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2 text-yellow-500">üì°</div>
      <div class="text-sm text-gray-500">Data Availability</div>
      <div class="text-2xl font-semibold text-yellow-600">98.5%</div>
    </div>
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4 text-center">
      <div class="text-2xl mb-2 text-red-500">üî•</div>
      <div class="text-sm text-gray-500">Failed Requests</div>
      <div class="text-2xl font-semibold text-red-600">0.03%</div>
    </div>
  </div>

  <!-- Site Health Matrix -->
  <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl">
    <div class="px-4 py-3 border-b border-gray-200 dark:border-gray-800 flex items-center justify-between">
      <h3 class="font-semibold">Site Health Matrix</h3>
      <div class="space-x-2">
        <button id="btnRefreshHealth" class="px-3 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 text-sm">Refresh</button>
        <button id="btnExportHealth" class="px-3 py-1.5 rounded-md border border-gray-200 dark:border-gray-700 text-sm">Export</button>
      </div>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-gray-800 text-white uppercase tracking-wide text-xs">
          <tr>
            <th class="px-3 py-2 text-left">Site</th>
            <th class="px-3 py-2 text-left">Overall Health</th>
            <th class="px-3 py-2 text-left">Inverters</th>
            <th class="px-3 py-2 text-left">Weather</th>
            <th class="px-3 py-2 text-left">Comms</th>
            <th class="px-3 py-2 text-left">Last Poll</th>
            <th class="px-3 py-2 text-left">Uptime</th>
          </tr>
        </thead>
        <tbody id="healthMatrixBody">
          <tr class="border-b border-gray-200 dark:border-gray-800">
            <td class="px-3 py-2 font-medium">Ankara Sincan GES</td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">Healthy</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">2/2</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">OK</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">OK</span></td>
            <td class="px-3 py-2">22.09.2025 20:59</td>
            <td class="px-3 py-2">99.9%</td>
          </tr>
          <tr class="border-b border-gray-200 dark:border-gray-800">
            <td class="px-3 py-2 font-medium">ODT√ú Teknokent GES</td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800">Degraded</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">2/2</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800">Timeout</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">OK</span></td>
            <td class="px-3 py-2">22.09.2025 20:57</td>
            <td class="px-3 py-2">98.2%</td>
          </tr>
          <tr class="border-b border-gray-200 dark:border-gray-800">
            <td class="px-3 py-2 font-medium">Antalya Manavgat GES</td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">Healthy</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">1/1</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">OK</span></td>
            <td class="px-3 py-2"><span class="inline-flex px-2 py-0.5 rounded-full text-xs bg-green-100 text-green-800">OK</span></td>
            <td class="px-3 py-2">22.09.2025 20:59</td>
            <td class="px-3 py-2">99.95%</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Performance Metrics -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <h3 class="font-semibold mb-2">Communication Performance</h3>
      <div class="space-y-3">
        <div class="flex justify-between text-sm">
          <span>Modbus TCP Success Rate</span>
          <span class="font-medium text-green-600">99.2%</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>Modbus RTU Success Rate</span>
          <span class="font-medium text-yellow-600">97.8%</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>MQTT Message Delivery</span>
          <span class="font-medium text-green-600">99.9%</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>Average Latency</span>
          <span class="font-medium text-blue-600">850ms</span>
        </div>
      </div>
    </div>
    
    <div class="bg-white dark:bg-gray-950 border border-gray-200 dark:border-gray-800 rounded-xl p-4">
      <h3 class="font-semibold mb-2">System Resources</h3>
      <div class="space-y-3">
        <div class="flex justify-between text-sm">
          <span>CPU Usage</span>
          <span class="font-medium text-green-600">15%</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>Memory Usage</span>
          <span class="font-medium text-yellow-600">68%</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>Disk I/O</span>
          <span class="font-medium text-green-600">Low</span>
        </div>
        <div class="flex justify-between text-sm">
          <span>Temperature</span>
          <span class="font-medium text-green-600">42¬∞C</span>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
  // Health & SLA specific JavaScript
  document.addEventListener('DOMContentLoaded', () => {
    // Initialize health monitoring UI
    setInterval(updateHealthMetrics, 30000); // Update every 30 seconds
  });
  
  function updateHealthMetrics() {
    fetch('/health')
      .then(response => response.json())
      .then(data => {
        console.log('Health update:', data);
        // Update health matrix table
      })
      .catch(error => console.error('Health update failed:', error));
  }
</script>
{% endblock %}